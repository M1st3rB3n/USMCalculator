<div class="card shadow">
    <div class="card-header {% if categorie.id %}bg-warning text-dark{% else %}bg-success text-white{% endif %}">
        <h1 class="h3 mb-0">{% if categorie.id %}Modifier la catégorie : {{ categorie.nom }}{% else %}Ajouter une catégorie{% endif %}</h1>
    </div>
    <div class="card-body">
        {{ form_start(form) }}
            {{ form_row(form.nom) }}

            <div class="mt-4 mb-4 p-3 border rounded bg-light">
                <h4 class="h5 mb-3">{{ form_label(form.annees) }}</h4>
                <div id="annees-list"
                     data-prototype="{{ form_widget(form.annees.vars.prototype)|e('html_attr') }}"
                     data-index="{{ form.annees|length }}">
                    {% for anneeField in form.annees %}
                        <div class="annee-item mb-2 d-flex gap-2">
                            <div class="flex-grow-1">
                                {{ form_widget(anneeField) }}
                                {{ form_errors(anneeField) }}
                            </div>
                            <button type="button" class="btn btn-outline-danger remove-annee">Supprimer</button>
                        </div>
                    {% endfor %}
                </div>
                <button type="button" class="btn btn-sm btn-outline-primary mt-2" id="add-annee">Ajouter une année</button>
            </div>

            <div class="d-flex justify-content-between mt-3">
                <a href="{{ path('app_categorie_index') }}" class="btn btn-secondary">Annuler</a>
                <button type="submit" class="btn {% if categorie.id %}btn-primary{% else %}btn-success{% endif %}">Enregistrer</button>
            </div>
        {{ form_end(form) }}
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const container = document.getElementById('annees-list');
        const addButton = document.getElementById('add-annee');

        if (addButton) {
            addButton.addEventListener('click', function() {
                const prototype = container.dataset.prototype;
                const index = parseInt(container.dataset.index);

                const newForm = prototype.replace(/__name__/g, index);
                container.dataset.index = index + 1;

                const div = document.createElement('div');
                div.classList.add('annee-item', 'mb-2', 'd-flex', 'gap-2');
                div.innerHTML = `
                    <div class="flex-grow-1">${newForm}</div>
                    <button type="button" class="btn btn-outline-danger remove-annee">Supprimer</button>
                `;

                container.appendChild(div);
            });
        }

        if (container) {
            container.addEventListener('click', function(e) {
                if (e.target.classList.contains('remove-annee')) {
                    e.target.closest('.annee-item').remove();
                }
            });
        }
    });
</script>
